define(["ember", "ember_data"], function (Ember, DS) {
	var App = Ember.Application.create();

	App.Person = DS.Model.extend({

		name: DS.attr('string'),

		age: DS.attr('number')

	});
	App.EditPersonController = Ember.ObjectController.extend({

		save: function () {
			store.commit();
			this.redirectToModel();
		},

		redirectToModel: function () {
			var router = this.get('target');
			var model = this.get('model');
			router.transitionTo('person', model);
		}

	});
	App.NewPersonController = App.EditPersonController.extend();
	App.PersonController = Ember.ObjectController.extend({

		destroy: function () {
			if(!confirm('Are you sure?')) return;
			this.get('model').deleteRecord();
			store.commit();
			this.get('target').transitionTo('people');
		}

	});
	App.NewPersonRoute = Ember.Route.extend({

		renderTemplate: function () {
			this.render('edit_person', {
				controller: 'new_person'
			});
		},

		model: function () {
			return person.createRecord();
		},

		exit: function () {
			var model = this.get('controller.model');
			if(!model.get('isSaving')) {
				model.deleteRecord();
			}
		}

	});
	App.IndexRoute = Ember.Route.extend({

		renderTemplate: function () {
			this.render('edit_person', {
				controller: 'new_person'
			});
		},

		model: function () {
			return App.Person.createRecord();
		},

		exit: function () {
			var model = this.get('controller.model');
			if(!model.get('isSaving')) {
				model.deleteRecord();
			}
		}

	});
	App.PersonRoute = Ember.Route.extend({

		model: function () {
			return App.Person.find();
		}

	});
	App.Router.map(function () {

		// generated by ember-generate --scaffold
		this.resource('people');
		this.resource('person', {
			path: '/people/:person_id'
		});
		this.route('edit_person', {
			path: '/people/:person_id/edit'
		});
		this.route('new_person', {
			path: '/people/new'
		});
		// end generated routes
	});
	App.store = DS.Store.extend({
		revision: 11,
		adapter: DS.RESTAdapter.create()
	}).create();
	return App;
});